const express = require('express');
const app = express();
const PORT = 3000;

// PROFESSIONAL: The flag comes from the container environment (Docker), 
// so you can change it without redeploying code.
const FLAG = process.env.FLAG || "LNM{dummy_flag_for_local_testing}";

// Serve the frontend
app.use(express.static('public'));

// Mock Database
// Real students have IDs starting at 2024001, etc.
// But we will use simple integers for the challenge logic.
const database = {
    1001: { id: 1001, name: "Alice Carter", role: "Student", gpa: "3.8" },
    1002: { id: 1002, name: "Bob Miller", role: "Student", gpa: "3.2" },
    1003: { id: 1003, name: "Charlie Davis", role: "Student", gpa: "2.9" },
    
    // THE VULNERABILITY:
    // This ID exists in the system but shouldn't be publicly accessible.
    // However, because there is no auth check, knowing the ID is enough.
    1337: { id: 1337, name: "SYSTEM_ADMIN", role: "SuperUser", gpa: "N/A", memo: FLAG }
};

app.get('/api/student', (req, res) => {
    // Parse the ID from the query string (e.g., ?id=1001)
    const id = parseInt(req.query.id);

    // SECURITY FLAW: Direct Object Reference
    // We check if the ID exists, but we NEVER check if the user is *allowed* to see it.
    if (database[id]) {
        res.json(database[id]);
    } else {
        // Professional Error Handling: Don't crash, just return 404
        res.status(404).json({ error: "Student ID not found in current semester syllabus." });
    }
});

app.listen(PORT, () => {
    console.log(`Server running on http://localhost:${PORT}`);
});